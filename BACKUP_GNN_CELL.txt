# ============================================================================
# BACKUP GNN CHECKPOINTS TO GOOGLE DRIVE
# ============================================================================
# Paste this into a Colab cell after training

from google.colab import drive
import os
import shutil
import glob
import datetime

print("Mounting Google Drive...")
drive.mount('/content/drive')

# Create backup folder with timestamp
timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
backup_dir = f"/content/drive/MyDrive/EstraNet_GNN_Backup_{timestamp}"
os.makedirs(backup_dir, exist_ok=True)
print(f"‚úÖ Created backup folder: {backup_dir}")

# The checkpoints are already in Drive, but let's also backup locally trained files
print("\nüìÇ Backing up GNN checkpoint files...")

# Copy checkpoint files from local directory (if any were saved locally)
local_checkpoint_files = glob.glob("trans_long*") + glob.glob("checkpoint") + glob.glob("loss.pkl")
if local_checkpoint_files:
    print(f"Found {len(local_checkpoint_files)} local checkpoint files")
    for file in local_checkpoint_files:
        try:
            shutil.copy2(file, backup_dir)
            print(f"  ‚úÖ {file}")
        except Exception as e:
            print(f"  ‚ùå {file}: {e}")
else:
    print("  No local checkpoints (they're in Drive already)")

# Copy GNN-specific code files
print("\nüìÑ Backing up GNN code files...")
code_files = [
    'gnn_layers.py',
    'gnn_estranet.py', 
    'train_trans.py',
    'transformer.py',
    'fast_attention.py'
]

for file in code_files:
    if os.path.exists(file):
        try:
            shutil.copy2(file, backup_dir)
            print(f"  ‚úÖ {file}")
        except:
            print(f"  ‚ö†Ô∏è  {file} not found")

# Copy results folder
print("\nüìä Backing up results...")
if os.path.exists("results"):
    try:
        shutil.copytree("results", f"{backup_dir}/results")
        print("  ‚úÖ results/")
    except Exception as e:
        print(f"  ‚ùå Failed: {e}")

# Verify Drive checkpoints exist
print("\nüîç Verifying GNN checkpoints in Drive...")
drive_checkpoint_dir = "/content/drive/MyDrive/EstraNet/checkpoints_gnn"
if os.path.exists(drive_checkpoint_dir):
    drive_files = os.listdir(drive_checkpoint_dir)
    checkpoint_count = len([f for f in drive_files if 'trans_long' in f or 'checkpoint' in f])
    print(f"  ‚úÖ Found {checkpoint_count} files in {drive_checkpoint_dir}")
else:
    print(f"  ‚ö†Ô∏è  Drive checkpoint directory not found: {drive_checkpoint_dir}")

print("\n" + "="*70)
print("üéâ BACKUP COMPLETE!")
print(f"üìÅ Backup location: {backup_dir}")
print("="*70)
